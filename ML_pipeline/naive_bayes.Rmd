---
title: "Untitled"
output: html_document
---

```{r}
library(dplyr)
data <- read.csv("../data/cohort_preprocessed.csv")
data <- data %>% select(-c(X))
rownames(data) <- data$icustay_id
data %>% head()
```

```{r}
# imbalanced dataset : 8% of target ==1
sum(data$icustay_expire_flag)/length(data$icustay_expire_flag)

# columns to standardize
col_to_standardize <- colnames(data)
col_to_standardize <- col_to_standardize[!col_to_standardize %in% c("icustay_id","icustay_expire_flag")]
col_to_standardize
```


Standardize data except icustay_id and icustay_expire_flag (target):
```{r}
library(caret)
preprocessParams <- preProcess(data[,col_to_standardize], method=c("center", "scale"))
transformed <- predict(preprocessParams, data[,col_to_standardize])
# transformed %>% head()
final <- cbind(transformed, data$icustay_expire_flag)
colnames(final) <- c(colnames(transformed), "icustay_expire_flag")
final %>% head()
```

```{r}
library(FactoMineR)
res.pca = PCA(final[,1:62], scale.unit=TRUE, ncp=5, graph=T)
```

Data split:
```{r}
final[,"icustay_expire_flag"] <- factor(final[,"icustay_expire_flag"])
trainIndex <- createDataPartition(final$icustay_expire_flag, p=0.80, list=FALSE)
dataTrain <- final[ trainIndex,]
dataTest <- final[-trainIndex,]
```

Naive Bayes Classifier:
```{r}
library(klaR)
# train a naive Bayes model
fit <- NaiveBayes(icustay_expire_flag~., data=dataTrain)
# make predictions
predictions <- predict(fit, dataTest[,1:62])
# summarize results
confusionMatrix(predictions$class, dataTest$icustay_expire_flag)
```

Undersampling of class 0 because we have an imbalanced dataset:
```{r}
# will work on that later
```

